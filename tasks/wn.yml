---
- name: Copy zk file from the frontend
  copy: 
    src: "/etc/mesos/zk"
    dest: "/etc/mesos/zk"

- name: Include DNS configuration
  include: "dns.yml"

- name: Stop and disable Zookeeer and Mesos master (Debian)
    block:
    - name: Stop Zookeeer and Mesos master services
      service: 
        name: "{{ item.name }}"
        state: stopped
      with_items:
        - name: "zookeeper"
        - name: "mesos-master"

    - name: Disable Zookeeer and Mesos master services
      copy:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        mode: "0664"        
      with_items:
        - src: "mesos-slave/disable_service.override.j2"
          dest: "/etc/init/zookeeper.override"
        - src: "mesos-slave/disable_service.override.j2"
          dest: "/etc/init/mesos-master.override"
  when: ansible_os_family == "Debian"

- name: Stop and disable Zookeeer and Mesos master (CentOS 7)
  command: "{{ item.command }}"
  with_items:
    - command: "systemctl stop zookeeper-server"
    - command: "systemctl stop mesos-master.service"
    - command: "systemctl disable zookeeper-server"
    - command: "systemctl disable mesos-master.service"
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version == "7"

- name: Set Mesos Slave configuration files
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "0664"
  with_items:
    - src: "mesos-slave/ip.j2"
      dest: "/etc/mesos-slave/ip"
    - src: "mesos-slave/hostname.j2"
      dest: "/etc/mesos-slave/hostname"
    - src: "mesos-slave/resources.j2"
      dest: "/etc/mesos-slave/resources"
    - src: "mesos-slave/executor_registration_timeout.j2"
      dest: "/etc/mesos-slave/executor_registration_timeout"
  notify:
    - start mesos-slave